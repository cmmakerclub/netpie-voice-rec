const VERSION='1.1.8',GEARAPIADDRESS='ga.netpie.io',GEARAPIPORT='8080',GEARAPISECUREPORT='8081',GBWSPORT='8083',GBWSSPORT='8084',USETLS=!0,MGREV='WJS1b',MINTOKDELAYTIME=100,MAXTOKDELAYTIME=3e4,DEBUGMODE=!1,MONLOOPINTERVAL=1e3,RETRYCONNECTIONINTERVAL=5e3,MESSAGEBUFFERSIZE=20;var toktime=MINTOKDELAYTIME,GEARAUTH=GEARAPIADDRESS,storejs=function(){var M,o={},u='undefined'==typeof window?global:window,_=u.document,y='localStorage',I='script';if(o.disabled=!1,o.version='1.3.20',o.set=function(){},o.get=function(){},o.has=function(C){return void 0!==o.get(C)},o.remove=function(){},o.clear=function(){},o.transact=function(C,N,R){null==R&&(R=N,N=null),null==N&&(N={});var P=o.get(C,N);R(P),o.set(C,P)},o.getAll=function(){},o.forEach=function(){},o.serialize=function(C){return JSON.stringify(C)},o.deserialize=function(C){if('string'==typeof C)try{return JSON.parse(C)}catch(N){return C||void 0}},function(){try{return y in u&&u[y]}catch(C){return!1}}())M=u[y],o.set=function(C,N){return void 0===N?o.remove(C):(M.setItem(C,o.serialize(N)),N)},o.get=function(C,N){var R=o.deserialize(M.getItem(C));return void 0===R?N:R},o.remove=function(C){M.removeItem(C)},o.clear=function(){M.clear()},o.getAll=function(){var C={};return o.forEach(function(N,R){C[N]=R}),C},o.forEach=function(C){for(var R,N=0;N<M.length;N++)R=M.key(N),C(R,o.get(R))};else if(_&&_.documentElement.addBehavior){var E,S;try{S=new ActiveXObject('htmlfile'),S.open(),S.write('<'+I+'>document.w=window</'+I+'><iframe src="/favicon.ico"></iframe>'),S.close(),E=S.w.frames[0].document,M=E.createElement('div')}catch(C){M=_.createElement('div'),E=_.body}var A=function(C){return function(){var N=Array.prototype.slice.call(arguments,0);N.unshift(M),E.appendChild(M),M.addBehavior('#default#userData'),M.load(y);var R=C.apply(o,N);return E.removeChild(M),R}},v=/[!"#$%&'()*+,\/\\:;<=>?@[\]^`{|}~]/g,T=function(C){return C.replace(/^d/,'___$&').replace(v,'___')};o.set=A(function(C,N,R){return(N=T(N),void 0===R)?o.remove(N):(C.setAttribute(N,o.serialize(R)),C.save(y),R)}),o.get=A(function(C,N,R){N=T(N);var P=o.deserialize(C.getAttribute(N));return void 0===P?R:P}),o.remove=A(function(C,N){N=T(N),C.removeAttribute(N),C.save(y)}),o.clear=A(function(C){var N=C.XMLDocument.documentElement.attributes;C.load(y);for(var R=N.length-1;0<=R;R--)C.removeAttribute(N[R].name);C.save(y)}),o.getAll=function(){var N={};return o.forEach(function(R,P){N[R]=P}),N},o.forEach=A(function(C,N){for(var U,R=C.XMLDocument.documentElement.attributes,P=0;U=R[P];++P)N(U.name,o.deserialize(C.getAttribute(U.name)))})}try{var O='__storejs__';o.set(O,O),o.get(O)!=O&&(o.disabled=!0),o.remove(O)}catch(C){o.disabled=!0}return o.enabled=!o.disabled,o}();console.log(storejs.enabled);var _localStorage={setItem:function(t,o){storejs.enabled&&storejs.set(t,o)},getItem:function(){if(storejs.enabled)return storejs.get(key)},removeItem:function(){storejs.enabled&&storejs.remove(key)},getAllItems:function(){return storejs.getAll()}};if('undefined'==typeof Paho&&(Paho={}),Paho.MQTT=function(t){function o(K,Q){var G=Q,z=K[Q],J=z>>4,Y=z&=15;Q+=1;var W,X=0,$=1;do{if(Q==K.length)return[null,G];W=K[Q++],X+=(127&W)*$,$*=128}while(0!=(128&W));var Z=Q+X;if(Z>K.length)return[null,G];var ee=new B(J);switch(J){case T.CONNACK:var te=K[Q++];1&te&&(ee.sessionPresent=!0),ee.returnCode=K[Q++];break;case T.PUBLISH:var se=3&Y>>1,ne=y(K,Q);Q+=2;var oe=S(K,Q,ne);Q+=ne,0<se&&(ee.messageIdentifier=y(K,Q),Q+=2);var re=new Paho.MQTT.Message(K.subarray(Q,Z));1==(1&Y)&&(re.retained=!0),8==(8&Y)&&(re.duplicate=!0),re.qos=se,re.destinationName=oe,ee.payloadMessage=re;break;case T.PUBACK:case T.PUBREC:case T.PUBREL:case T.PUBCOMP:case T.UNSUBACK:ee.messageIdentifier=y(K,Q);break;case T.SUBACK:ee.messageIdentifier=y(K,Q),Q+=2,ee.returnCode=K.subarray(Q,Z);break;default:;}return[ee,Z]}function u(K,Q,G){return Q[G++]=K>>8,Q[G++]=K%256,G}function _(K,Q,G,z){return z=u(Q,G,z),E(K,G,z),z+Q}function y(K,Q){return 256*K[Q]+K[Q+1]}function I(K){var Q=[,],G=0;do{var z=K%128;K>>=7,0<K&&(z|=128),Q[G++]=z}while(0<K&&4>G);return Q}function M(K){for(var z,Q=0,G=0;G<K.length;G++)z=K.charCodeAt(G),2047<z?(55296<=z&&56319>=z&&(G++,Q++),Q+=3):127<z?Q+=2:Q++;return Q}function E(K,Q,G){for(var Y,z=G,J=0;J<K.length;J++){if(Y=K.charCodeAt(J),55296<=Y&&56319>=Y){var W=K.charCodeAt(++J);if(isNaN(W))throw new Error(P(N.MALFORMED_UNICODE,[Y,W]));Y=(Y-55296<<10)+(W-56320)+65536}127>=Y?Q[z++]=Y:2047>=Y?(Q[z++]=192|31&Y>>6,Q[z++]=128|63&Y):65535>=Y?(Q[z++]=224|15&Y>>12,Q[z++]=128|63&Y>>6,Q[z++]=128|63&Y):(Q[z++]=240|7&Y>>18,Q[z++]=128|63&Y>>12,Q[z++]=128|63&Y>>6,Q[z++]=128|63&Y)}return Q}function S(K,Q,G){for(var J,W,z='',Y=Q;Y<Q+G;){if(W=K[Y++],128>W)J=W;else{var X=K[Y++]-128;if(0>X)throw new Error(P(N.MALFORMED_UTF,[W.toString(16),X.toString(16),'']));if(224>W)J=64*(W-192)+X;else{var $=K[Y++]-128;if(0>$)throw new Error(P(N.MALFORMED_UTF,[W.toString(16),X.toString(16),$.toString(16)]));if(240>W)J=4096*(W-224)+64*X+$;else{var Z=K[Y++]-128;if(0>Z)throw new Error(P(N.MALFORMED_UTF,[W.toString(16),X.toString(16),$.toString(16),Z.toString(16)]));if(248>W)J=262144*(W-240)+4096*X+64*$+Z;else throw new Error(P(N.MALFORMED_UTF,[W.toString(16),X.toString(16),$.toString(16),Z.toString(16)]))}}}65535<J&&(J-=65536,z+=String.fromCharCode(55296+(J>>10)),J=56320+(1023&J)),z+=String.fromCharCode(J)}return z}var T={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},O=function(K,Q){for(var G in K)if(K.hasOwnProperty(G))if(!Q.hasOwnProperty(G)){var z='Unknown property, '+G+'. Valid properties are:';for(var G in Q)Q.hasOwnProperty(G)&&(z=z+' '+G);throw new Error(z)}else if(typeof K[G]!==Q[G])throw new Error(P(N.INVALID_TYPE,[typeof K[G],G]))},C=function(K,Q){return function(){return K.apply(Q,arguments)}},N={OK:{code:0,text:'AMQJSC0000I OK.'},CONNECT_TIMEOUT:{code:1,text:'AMQJSC0001E Connect timed out.'},SUBSCRIBE_TIMEOUT:{code:2,text:'AMQJS0002E Subscribe timed out.'},UNSUBSCRIBE_TIMEOUT:{code:3,text:'AMQJS0003E Unsubscribe timed out.'},PING_TIMEOUT:{code:4,text:'AMQJS0004E Ping timed out.'},INTERNAL_ERROR:{code:5,text:'AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}'},CONNACK_RETURNCODE:{code:6,text:'AMQJS0006E Bad Connack return code:{0} {1}.'},SOCKET_ERROR:{code:7,text:'AMQJS0007E Socket error:{0}.'},SOCKET_CLOSE:{code:8,text:'AMQJS0008I Socket closed.'},MALFORMED_UTF:{code:9,text:'AMQJS0009E Malformed UTF data:{0} {1} {2}.'},UNSUPPORTED:{code:10,text:'AMQJS0010E {0} is not supported by this browser.'},INVALID_STATE:{code:11,text:'AMQJS0011E Invalid state {0}.'},INVALID_TYPE:{code:12,text:'AMQJS0012E Invalid type {0} for {1}.'},INVALID_ARGUMENT:{code:13,text:'AMQJS0013E Invalid argument {0} for {1}.'},UNSUPPORTED_OPERATION:{code:14,text:'AMQJS0014E Unsupported operation.'},INVALID_STORED_DATA:{code:15,text:'AMQJS0015E Invalid data in local storage key={0} value={1}.'},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:'AMQJS0016E Invalid MQTT message type {0}.'},MALFORMED_UNICODE:{code:17,text:'AMQJS0017E Malformed Unicode string:{0} {1}.'}},R={0:'Connection Accepted',1:'Connection Refused: unacceptable protocol version',2:'Connection Refused: identifier rejected',3:'Connection Refused: server unavailable',4:'Connection Refused: bad user name or password',5:'Connection Refused: not authorized'},P=function(K,Q){var G=K.text;if(Q)for(var z,J,Y=0;Y<Q.length;Y++)if(z='{'+Y+'}',J=G.indexOf(z),0<J){var W=G.substring(0,J),X=G.substring(J+z.length);G=W+Q[Y]+X}return G},U=[0,6,77,81,73,115,100,112,3],L=[0,4,77,81,84,84,4],B=function(K,Q){for(var G in this.type=K,Q)Q.hasOwnProperty(G)&&(this[G]=Q[G])};B.prototype.encode=function(){var K=(15&this.type)<<4,Q=0,G=[],z=0;switch(void 0!=this.messageIdentifier&&(Q+=2),this.type){case T.CONNECT:switch(this.mqttVersion){case 3:Q+=U.length+3;break;case 4:Q+=L.length+3;}if(Q+=M(this.clientId)+2,void 0!=this.willMessage){Q+=M(this.willMessage.destinationName)+2;var J=this.willMessage.payloadBytes;J instanceof Uint8Array||(J=new Uint8Array(W)),Q+=J.byteLength+2}void 0!=this.userName&&(Q+=M(this.userName)+2),void 0!=this.password&&(Q+=M(this.password)+2);break;case T.SUBSCRIBE:K|=2;for(var Y=0;Y<this.topics.length;Y++)G[Y]=M(this.topics[Y]),Q+=G[Y]+2;Q+=this.requestedQos.length;break;case T.UNSUBSCRIBE:K|=2;for(var Y=0;Y<this.topics.length;Y++)G[Y]=M(this.topics[Y]),Q+=G[Y]+2;break;case T.PUBREL:K|=2;break;case T.PUBLISH:this.payloadMessage.duplicate&&(K|=8),K=K|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(K|=1),z=M(this.payloadMessage.destinationName),Q+=z+2;var W=this.payloadMessage.payloadBytes;Q+=W.byteLength,W instanceof ArrayBuffer?W=new Uint8Array(W):!(W instanceof Uint8Array)&&(W=new Uint8Array(W.buffer));break;case T.DISCONNECT:break;default:;}var X=I(Q),$=X.length+1,Z=new ArrayBuffer(Q+$),ee=new Uint8Array(Z);if(ee[0]=K,ee.set(X,1),this.type==T.PUBLISH)$=_(this.payloadMessage.destinationName,z,ee,$);else if(this.type==T.CONNECT){switch(this.mqttVersion){case 3:ee.set(U,$),$+=U.length;break;case 4:ee.set(L,$),$+=L.length;}var te=0;this.cleanSession&&(te=2),void 0!=this.willMessage&&(te|=4,te|=this.willMessage.qos<<3,this.willMessage.retained&&(te|=32)),void 0!=this.userName&&(te|=128),void 0!=this.password&&(te|=64),ee[$++]=te,$=u(this.keepAliveInterval,ee,$)}switch(void 0!=this.messageIdentifier&&($=u(this.messageIdentifier,ee,$)),this.type){case T.CONNECT:$=_(this.clientId,M(this.clientId),ee,$),void 0!=this.willMessage&&($=_(this.willMessage.destinationName,M(this.willMessage.destinationName),ee,$),$=u(J.byteLength,ee,$),ee.set(J,$),$+=J.byteLength),void 0!=this.userName&&($=_(this.userName,M(this.userName),ee,$)),void 0!=this.password&&($=_(this.password,M(this.password),ee,$));break;case T.PUBLISH:ee.set(W,$);break;case T.SUBSCRIBE:for(var Y=0;Y<this.topics.length;Y++)$=_(this.topics[Y],G[Y],ee,$),ee[$++]=this.requestedQos[Y];break;case T.UNSUBSCRIBE:for(var Y=0;Y<this.topics.length;Y++)$=_(this.topics[Y],G[Y],ee,$);break;default:}return Z};var D=function(K,Q,G){this._client=K,this._window=Q,this._keepAliveInterval=1e3*G,this.isReset=!1;var z=new B(T.PINGREQ).encode(),J=function(W){return function(){return Y.apply(W)}},Y=function(){this.isReset?(this.isReset=!1,this._client._trace('Pinger.doPing','send PINGREQ'),this._client.socket.send(z),this.timeout=this._window.setTimeout(J(this),this._keepAliveInterval)):(this._client._trace('Pinger.doPing','Timed out'),this._client._disconnected(N.PING_TIMEOUT.code,P(N.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),0<this._keepAliveInterval&&(this.timeout=setTimeout(J(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},w=function(K,Q,G,z,J){this._window=Q,G||(G=30);this.timeout=setTimeout(function(W,X,$){return function(){return W.apply(X,$)}}(z,K,J),1e3*G),this.cancel=function(){this._window.clearTimeout(this.timeout)}},V=function(K,Q,G,z,J){if(!('WebSocket'in t&&null!==t.WebSocket))throw new Error(P(N.UNSUPPORTED,['WebSocket']));if(!('ArrayBuffer'in t&&null!==t.ArrayBuffer))throw new Error(P(N.UNSUPPORTED,['ArrayBuffer']));for(var Y in this._trace('Paho.MQTT.Client',K,Q,G,z,J),this.host=Q,this.port=G,this.path=z,this.uri=K,this.clientId=J,this._localKey=Q+':'+G+('/mqtt'==z?'':':'+z)+':'+J+':',this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0,_localStorage.getItems)(0==Y.indexOf('Sent:'+this._localKey)||0==Y.indexOf('Received:'+this._localKey))&&this.restore(Y)};V.prototype.host,V.prototype.port,V.prototype.path,V.prototype.uri,V.prototype.clientId,V.prototype.socket,V.prototype.connected=!1,V.prototype.maxMessageIdentifier=65536,V.prototype.connectOptions,V.prototype.hostIndex,V.prototype.onConnectionLost,V.prototype.onMessageDelivered,V.prototype.onMessageArrived,V.prototype.onError,V.prototype.traceFunction,V.prototype._msg_queue=null,V.prototype._connectTimeout,V.prototype.sendPinger=null,V.prototype.receivePinger=null,V.prototype.receiveBuffer=null,V.prototype._traceBuffer=null,V.prototype._MAX_TRACE_ENTRIES=100,V.prototype.connect=function(K){var Q=this._traceMask(K,'password');if(this._trace('Client.connect',Q,this.socket,this.connected),this.connected)throw new Error(P(N.INVALID_STATE,['already connected']));if(this.socket)throw new Error(P(N.INVALID_STATE,['already connected']));this.connectOptions=K,K.uris?(this.hostIndex=0,this._doConnect(K.uris[0])):this._doConnect(this.uri)},V.prototype.subscribe=function(K,Q){if(this._trace('Client.subscribe',K,Q),!this.connected)throw new Error(P(N.INVALID_STATE,['not connected']));var G=new B(T.SUBSCRIBE);G.topics=[K],G.requestedQos=void 0==Q.qos?[0]:[Q.qos],Q.onSuccess&&(G.onSuccess=function(z){Q.onSuccess({invocationContext:Q.invocationContext,grantedQos:z})}),Q.onFailure&&(G.onFailure=function(z){Q.onFailure({invocationContext:Q.invocationContext,errorCode:z})}),Q.timeout&&(G.timeOut=new w(this,window,Q.timeout,Q.onFailure,[{invocationContext:Q.invocationContext,errorCode:N.SUBSCRIBE_TIMEOUT.code,errorMessage:P(N.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(G),this._schedule_message(G)},V.prototype.unsubscribe=function(K,Q){if(this._trace('Client.unsubscribe',K,Q),!this.connected)throw new Error(P(N.INVALID_STATE,['not connected']));var G=new B(T.UNSUBSCRIBE);G.topics=[K],Q.onSuccess&&(G.callback=function(){Q.onSuccess({invocationContext:Q.invocationContext})}),Q.timeout&&(G.timeOut=new w(this,window,Q.timeout,Q.onFailure,[{invocationContext:Q.invocationContext,errorCode:N.UNSUBSCRIBE_TIMEOUT.code,errorMessage:P(N.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(G),this._schedule_message(G)},V.prototype.send=function(K){if(this._trace('Client.send',K),!this.connected)throw new Error(P(N.INVALID_STATE,['not connected']));wireMessage=new B(T.PUBLISH),wireMessage.payloadMessage=K,0<K.qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},V.prototype.disconnect=function(){if(this._trace('Client.disconnect'),!this.socket)throw new Error(P(N.INVALID_STATE,['not connecting or connected']));wireMessage=new B(T.DISCONNECT),this._notify_msg_sent[wireMessage]=C(this._disconnected,this),this._schedule_message(wireMessage)},V.prototype.getTraceLog=function(){if(null!==this._traceBuffer){for(var K in this._trace('Client.getTraceLog',new Date),this._trace('Client.getTraceLog in flight messages',this._sentMessages.length),this._sentMessages)this._trace('_sentMessages ',K,this._sentMessages[K]);for(var K in this._receivedMessages)this._trace('_receivedMessages ',K,this._receivedMessages[K]);return this._traceBuffer}},V.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace('Client.startTrace',new Date,'1.0.1')},V.prototype.stopTrace=function(){delete this._traceBuffer},V.prototype._doConnect=function(K){if(this.connectOptions.useSSL){var Q=K.split(':');Q[0]='wss',K=Q.join(':')}this.connected=!1,this.socket=4>this.connectOptions.mqttVersion?new WebSocket(K,['mqttv3.1']):new WebSocket(K,['mqtt']),this.socket.binaryType='arraybuffer',this.socket.onopen=C(this._on_socket_open,this),this.socket.onmessage=C(this._on_socket_message,this),this.socket.onerror=C(this._on_socket_error,this),this.socket.onclose=C(this._on_socket_close,this),this.sendPinger=new D(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new D(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new w(this,window,this.connectOptions.timeout,this._disconnected,[N.CONNECT_TIMEOUT.code,P(N.CONNECT_TIMEOUT)])},V.prototype._schedule_message=function(K){this._msg_queue.push(K),this.connected&&this._process_queue()},V.prototype.store=function(K,Q){var G={type:Q.type,messageIdentifier:Q.messageIdentifier,version:1};switch(Q.type){case T.PUBLISH:Q.pubRecReceived&&(G.pubRecReceived=!0),G.payloadMessage={};for(var z='',J=Q.payloadMessage.payloadBytes,Y=0;Y<J.length;Y++)15>=J[Y]?z=z+'0'+J[Y].toString(16):z+=J[Y].toString(16);G.payloadMessage.payloadHex=z,G.payloadMessage.qos=Q.payloadMessage.qos,G.payloadMessage.destinationName=Q.payloadMessage.destinationName,Q.payloadMessage.duplicate&&(G.payloadMessage.duplicate=!0),Q.payloadMessage.retained&&(G.payloadMessage.retained=!0),0==K.indexOf('Sent:')&&(void 0===Q.sequence&&(Q.sequence=++this._sequence),G.sequence=Q.sequence);break;default:throw Error(P(N.INVALID_STORED_DATA,[key,G]));}_localStorage.setItem(K+this._localKey+Q.messageIdentifier,JSON.stringify(G))},V.prototype.restore=function(K){var Q=_localStorage.getItem(K),G=JSON.parse(Q),z=new B(G.type,G);switch(G.type){case T.PUBLISH:for(var $,J=G.payloadMessage.payloadHex,Y=new ArrayBuffer(J.length/2),W=new Uint8Array(Y),X=0;2<=J.length;)$=parseInt(J.substring(0,2),16),J=J.substring(2,J.length),W[X++]=$;var Z=new Paho.MQTT.Message(W);Z.qos=G.payloadMessage.qos,Z.destinationName=G.payloadMessage.destinationName,G.payloadMessage.duplicate&&(Z.duplicate=!0),G.payloadMessage.retained&&(Z.retained=!0),z.payloadMessage=Z;break;default:throw Error(P(N.INVALID_STORED_DATA,[K,Q]));}0==K.indexOf('Sent:'+this._localKey)?(z.payloadMessage.duplicate=!0,this._sentMessages[z.messageIdentifier]=z):0==K.indexOf('Received:'+this._localKey)&&(this._receivedMessages[z.messageIdentifier]=z)},V.prototype._process_queue=function(){for(var K=null,Q=this._msg_queue.reverse();K=Q.pop();)this._socket_send(K),this._notify_msg_sent[K]&&(this._notify_msg_sent[K](),delete this._notify_msg_sent[K])},V.prototype._requires_ack=function(K){var Q=Object.keys(this._sentMessages).length;if(Q>this.maxMessageIdentifier)throw Error('Too many messages:'+Q);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;K.messageIdentifier=this._message_identifier,this._sentMessages[K.messageIdentifier]=K,K.type===T.PUBLISH&&this.store('Sent:',K),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},V.prototype._on_socket_open=function(){var K=new B(T.CONNECT,this.connectOptions);K.clientId=this.clientId,this._socket_send(K)},V.prototype._on_socket_message=function(K){this._trace('Client._on_socket_message',K.data),this.receivePinger.reset();for(var Q=this._deframeMessages(K.data),G=0;G<Q.length;G+=1)this._handleMessage(Q[G])},V.prototype._deframeMessages=function(K){var Q=new Uint8Array(K);if(this.receiveBuffer){var G=new Uint8Array(this.receiveBuffer.length+Q.length);G.set(this.receiveBuffer),G.set(Q,this.receiveBuffer.length),Q=G,delete this.receiveBuffer}try{for(var z=0,J=[];z<Q.length;){var Y=o(Q,z),W=Y[0];if(z=Y[1],null!==W)J.push(W);else break}z<Q.length&&(this.receiveBuffer=Q.subarray(z))}catch(X){return void this._disconnected(N.INTERNAL_ERROR.code,P(N.INTERNAL_ERROR,[X.message,X.stack.toString()]))}return J},V.prototype._handleMessage=function(K){this._trace('Client._handleMessage',K);try{switch(K.type){case T.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var Q in this._sentMessages){var G=this._sentMessages[Q];_localStorage.removeItem('Sent:'+this._localKey+G.messageIdentifier)}for(var Q in this._sentMessages={},this._receivedMessages){var z=this._receivedMessages[Q];_localStorage.removeItem('Received:'+this._localKey+z.messageIdentifier)}this._receivedMessages={}}if(0===K.returnCode)this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);else{0<K.returnCode&&5>=K.returnCode&&this.onError&&this.onError({code:K.returnCode,msg:R[K.returnCode]}),this._disconnected(N.CONNACK_RETURNCODE.code,P(N.CONNACK_RETURNCODE,[K.returnCode,R[K.returnCode]]));break}var J=[];for(var Y in this._sentMessages)this._sentMessages.hasOwnProperty(Y)&&J.push(this._sentMessages[Y]);for(var G,J=J.sort(function(ee,te){return ee.sequence-te.sequence}),W=0,X=J.length;W<X;W++)if(G=J[W],G.type==T.PUBLISH&&G.pubRecReceived){var $=new B(T.PUBREL,{messageIdentifier:G.messageIdentifier});this._schedule_message($)}else this._schedule_message(G);this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case T.PUBLISH:this._receivePublish(K);break;case T.PUBACK:var G=this._sentMessages[K.messageIdentifier];G&&(delete this._sentMessages[K.messageIdentifier],_localStorage.removeItem('Sent:'+this._localKey+K.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(G.payloadMessage));break;case T.PUBREC:var G=this._sentMessages[K.messageIdentifier];if(G){G.pubRecReceived=!0;var $=new B(T.PUBREL,{messageIdentifier:K.messageIdentifier});this.store('Sent:',G),this._schedule_message($)}break;case T.PUBREL:var z=this._receivedMessages[K.messageIdentifier];_localStorage.removeItem('Received:'+this._localKey+K.messageIdentifier),z&&(this._receiveMessage(z),delete this._receivedMessages[K.messageIdentifier]);var Z=new B(T.PUBCOMP,{messageIdentifier:K.messageIdentifier});this._schedule_message(Z);break;case T.PUBCOMP:var G=this._sentMessages[K.messageIdentifier];delete this._sentMessages[K.messageIdentifier],_localStorage.removeItem('Sent:'+this._localKey+K.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(G.payloadMessage);break;case T.SUBACK:var G=this._sentMessages[K.messageIdentifier];G&&(G.timeOut&&G.timeOut.cancel(),K.returnCode.indexOf=Array.prototype.indexOf,-1===K.returnCode.indexOf(128)?G.onSuccess&&G.onSuccess(K.returnCode):G.onFailure&&G.onFailure(K.returnCode),delete this._sentMessages[K.messageIdentifier]);break;case T.UNSUBACK:var G=this._sentMessages[K.messageIdentifier];G&&(G.timeOut&&G.timeOut.cancel(),G.callback&&G.callback(),delete this._sentMessages[K.messageIdentifier]);break;case T.PINGRESP:this.sendPinger.reset();break;case T.DISCONNECT:this._disconnected(N.INVALID_MQTT_MESSAGE_TYPE.code,P(N.INVALID_MQTT_MESSAGE_TYPE,[K.type]));break;default:this._disconnected(N.INVALID_MQTT_MESSAGE_TYPE.code,P(N.INVALID_MQTT_MESSAGE_TYPE,[K.type]));}}catch(ee){return void this._disconnected(N.INTERNAL_ERROR.code,P(N.INTERNAL_ERROR,[ee.message,ee.stack.toString()]))}},V.prototype._on_socket_error=function(K){this._disconnected(N.SOCKET_ERROR.code,P(N.SOCKET_ERROR,[K.data]))},V.prototype._on_socket_close=function(){this._disconnected(N.SOCKET_CLOSE.code,P(N.SOCKET_CLOSE))},V.prototype._socket_send=function(K){if(1==K.type){var Q=this._traceMask(K,'password');this._trace('Client._socket_send',Q)}else this._trace('Client._socket_send',K);this.socket.send(K.encode()),this.sendPinger.reset()},V.prototype._receivePublish=function(K){switch(K.payloadMessage.qos){case'undefined':case 0:this._receiveMessage(K);break;case 1:var Q=new B(T.PUBACK,{messageIdentifier:K.messageIdentifier});this._schedule_message(Q),this._receiveMessage(K);break;case 2:this._receivedMessages[K.messageIdentifier]=K,this.store('Received:',K);var G=new B(T.PUBREC,{messageIdentifier:K.messageIdentifier});this._schedule_message(G);break;default:throw Error('Invaild qos='+wireMmessage.payloadMessage.qos);}},V.prototype._receiveMessage=function(K){this.onMessageArrived&&this.onMessageArrived(K.payloadMessage)},V.prototype._disconnected=function(K,Q){this._trace('Client._disconnected',K,Q),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===K&&(K=N.OK.code,Q=P(N.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:K,errorMessage:Q})):4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace('Failed to connect V4, dropping back to V3'),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:K,errorMessage:Q}))},V.prototype._trace=function(){if(this.traceFunction){for(var K in arguments)'undefined'!=typeof arguments[K]&&(arguments[K]=JSON.stringify(arguments[K]));var Q=Array.prototype.slice.call(arguments).join('');this.traceFunction({severity:'Debug',message:Q})}if(null!==this._traceBuffer)for(var K=0,G=arguments.length;K<G;K++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===K?this._traceBuffer.push(arguments[K]):'undefined'==typeof arguments[K]?this._traceBuffer.push(arguments[K]):this._traceBuffer.push('  '+JSON.stringify(arguments[K]))},V.prototype._traceMask=function(K,Q){var G={};for(var z in K)K.hasOwnProperty(z)&&(G[z]=z==Q?'******':K[z]);return G};var H=function(K,Q,G,z){var J;if('string'!=typeof K)throw new Error(P(N.INVALID_TYPE,[typeof K,'host']));if(2==arguments.length){z=Q,J=K;var Y=J.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(Y)K=Y[4]||Y[2],Q=parseInt(Y[7]),G=Y[8];else throw new Error(P(N.INVALID_ARGUMENT,[K,'host']))}else{if(3==arguments.length&&(z=G,G='/mqtt'),'number'!=typeof Q||0>Q)throw new Error(P(N.INVALID_TYPE,[typeof Q,'port']));if('string'!=typeof G)throw new Error(P(N.INVALID_TYPE,[typeof G,'path']));var W=-1!=K.indexOf(':')&&'['!=K.slice(0,1)&&']'!=K.slice(-1);J='ws://'+(W?'['+K+']':K)+':'+Q+G}for(var Z,X=0,$=0;$<z.length;$++)Z=z.charCodeAt($),55296<=Z&&56319>=Z&&$++,X++;if('string'!=typeof z||65535<X)throw new Error(P(N.INVALID_ARGUMENT,[z,'clientId']));var ee=new V(J,K,Q,G,z);this._getHost=function(){return K},this._setHost=function(){throw new Error(P(N.UNSUPPORTED_OPERATION))},this._getPort=function(){return Q},this._setPort=function(){throw new Error(P(N.UNSUPPORTED_OPERATION))},this._getPath=function(){return G},this._setPath=function(){throw new Error(P(N.UNSUPPORTED_OPERATION))},this._getURI=function(){return J},this._setURI=function(){throw new Error(P(N.UNSUPPORTED_OPERATION))},this._getClientId=function(){return ee.clientId},this._setClientId=function(){throw new Error(P(N.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return ee.onConnectionLost},this._setOnConnectionLost=function(te){if('function'==typeof te)ee.onConnectionLost=te;else throw new Error(P(N.INVALID_TYPE,[typeof te,'onConnectionLost']))},this._getOnMessageDelivered=function(){return ee.onMessageDelivered},this._setOnMessageDelivered=function(te){if('function'==typeof te)ee.onMessageDelivered=te;else throw new Error(P(N.INVALID_TYPE,[typeof te,'onMessageDelivered']))},this._getOnMessageArrived=function(){return ee.onMessageArrived},this._setOnMessageArrived=function(te){if('function'==typeof te)ee.onMessageArrived=te;else throw new Error(P(N.INVALID_TYPE,[typeof te,'onMessageArrived']))},this._getOnError=function(){return ee.onError},this._setOnError=function(te){if('function'==typeof te)ee.onError=te;else throw new Error(P(N.INVALID_TYPE,[typeof te,'onError']))},this._getTrace=function(){return ee.traceFunction},this._setTrace=function(te){if('function'==typeof te)ee.traceFunction=te;else throw new Error(P(N.INVALID_TYPE,[typeof te,'onTrace']))},this.connect=function(te){if(te=te||{},O(te,{timeout:'number',userName:'string',password:'string',willMessage:'object',keepAliveInterval:'number',cleanSession:'boolean',useSSL:'boolean',invocationContext:'object',onSuccess:'function',onFailure:'function',hosts:'object',ports:'object',mqttVersion:'number'}),void 0===te.keepAliveInterval&&(te.keepAliveInterval=60),4<te.mqttVersion||3>te.mqttVersion)throw new Error(P(N.INVALID_ARGUMENT,[te.mqttVersion,'connectOptions.mqttVersion']));if(void 0===te.mqttVersion?(te.mqttVersionExplicit=!1,te.mqttVersion=4):te.mqttVersionExplicit=!0,void 0===te.password&&void 0!==te.userName)throw new Error(P(N.INVALID_ARGUMENT,[te.password,'connectOptions.password']));if(te.willMessage){if(!(te.willMessage instanceof F))throw new Error(P(N.INVALID_TYPE,[te.willMessage,'connectOptions.willMessage']));if(te.willMessage.stringPayload,'undefined'==typeof te.willMessage.destinationName)throw new Error(P(N.INVALID_TYPE,[typeof te.willMessage.destinationName,'connectOptions.willMessage.destinationName']))}if('undefined'==typeof te.cleanSession&&(te.cleanSession=!0),te.hosts){if(!(te.hosts instanceof Array))throw new Error(P(N.INVALID_ARGUMENT,[te.hosts,'connectOptions.hosts']));if(1>te.hosts.length)throw new Error(P(N.INVALID_ARGUMENT,[te.hosts,'connectOptions.hosts']));for(var se=!1,ne=0;ne<te.hosts.length;ne++){if('string'!=typeof te.hosts[ne])throw new Error(P(N.INVALID_TYPE,[typeof te.hosts[ne],'connectOptions.hosts['+ne+']']));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(te.hosts[ne])){if(0==ne)se=!0;else if(!se)throw new Error(P(N.INVALID_ARGUMENT,[te.hosts[ne],'connectOptions.hosts['+ne+']']));}else if(se)throw new Error(P(N.INVALID_ARGUMENT,[te.hosts[ne],'connectOptions.hosts['+ne+']']))}if(!se){if(!te.ports)throw new Error(P(N.INVALID_ARGUMENT,[te.ports,'connectOptions.ports']));if(!(te.ports instanceof Array))throw new Error(P(N.INVALID_ARGUMENT,[te.ports,'connectOptions.ports']));if(te.hosts.length!=te.ports.length)throw new Error(P(N.INVALID_ARGUMENT,[te.ports,'connectOptions.ports']));te.uris=[];for(var ne=0;ne<te.hosts.length;ne++){if('number'!=typeof te.ports[ne]||0>te.ports[ne])throw new Error(P(N.INVALID_TYPE,[typeof te.ports[ne],'connectOptions.ports['+ne+']']));var oe=te.hosts[ne],re=te.ports[ne],ie=-1!=oe.indexOf(':');J='ws://'+(ie?'['+oe+']':oe)+':'+re+G,te.uris.push(J)}}else te.uris=te.hosts}ee.connect(te)},this.subscribe=function(te,se){if('string'!=typeof te)throw new Error('Invalid argument:'+te);if(se=se||{},O(se,{qos:'number',invocationContext:'object',onSuccess:'function',onFailure:'function',timeout:'number'}),se.timeout&&!se.onFailure)throw new Error('subscribeOptions.timeout specified with no onFailure callback.');if('undefined'!=typeof se.qos&&0!==se.qos&&1!==se.qos&&2!==se.qos)throw new Error(P(N.INVALID_ARGUMENT,[se.qos,'subscribeOptions.qos']));ee.subscribe(te,se)},this.unsubscribe=function(te,se){if('string'!=typeof te)throw new Error('Invalid argument:'+te);if(se=se||{},O(se,{invocationContext:'object',onSuccess:'function',onFailure:'function',timeout:'number'}),se.timeout&&!se.onFailure)throw new Error('unsubscribeOptions.timeout specified with no onFailure callback.');ee.unsubscribe(te,se)},this.send=function(te,se,ne,oe){var re;if(0==arguments.length)throw new Error('Invalid argument.length');else if(1==arguments.length){if(!(te instanceof F)&&'string'!=typeof te)throw new Error('Invalid argument:'+typeof te);if(re=te,'undefined'==typeof re.destinationName)throw new Error(P(N.INVALID_ARGUMENT,[re.destinationName,'Message.destinationName']));ee.send(re)}else re=new F(se),re.destinationName=te,3<=arguments.length&&(re.qos=ne),4<=arguments.length&&(re.retained=oe),ee.send(re)},this.disconnect=function(){ee.disconnect()},this.getTraceLog=function(){return ee.getTraceLog()},this.startTrace=function(){ee.startTrace()},this.stopTrace=function(){ee.stopTrace()},this.isConnected=function(){return ee.connected}};H.prototype={get host(){return this._getHost()},set host(K){this._setHost(K)},get port(){return this._getPort()},set port(K){this._setPort(K)},get path(){return this._getPath()},set path(K){this._setPath(K)},get clientId(){return this._getClientId()},set clientId(K){this._setClientId(K)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(K){this._setOnConnectionLost(K)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(K){this._setOnMessageDelivered(K)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(K){this._setOnMessageArrived(K)},get onError(){return this._getOnError()},set onError(K){this._setOnError(K)},get trace(){return this._getTrace()},set trace(K){this._setTrace(K)}};var F=function(K){var Q;if('string'==typeof K||K instanceof ArrayBuffer||K instanceof Int8Array||K instanceof Uint8Array||K instanceof Int16Array||K instanceof Uint16Array||K instanceof Int32Array||K instanceof Uint32Array||K instanceof Float32Array||K instanceof Float64Array)Q=K;else throw P(N.INVALID_ARGUMENT,[K,'newPayload']);this._getPayloadString=function(){return'string'==typeof Q?Q:S(Q,0,Q.length)},this._getPayloadBytes=function(){if('string'==typeof Q){var W=new ArrayBuffer(M(Q)),X=new Uint8Array(W);return E(Q,X,0),X}return Q};var G;this._getDestinationName=function(){return G},this._setDestinationName=function(W){if('string'==typeof W)G=W;else throw new Error(P(N.INVALID_ARGUMENT,[W,'newDestinationName']))};var z=0;this._getQos=function(){return z},this._setQos=function(W){if(0===W||1===W||2===W)z=W;else throw new Error('Invalid argument:'+W)};var J=!1;this._getRetained=function(){return J},this._setRetained=function(W){if('boolean'==typeof W)J=W;else throw new Error(P(N.INVALID_ARGUMENT,[W,'newRetained']))};var Y=!1;this._getDuplicate=function(){return Y},this._setDuplicate=function(W){Y=W}};return F.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(K){this._setDestinationName(K)},get qos(){return this._getQos()},set qos(K){this._setQos(K)},get retained(){return this._getRetained()},set retained(K){this._setRetained(K)},get duplicate(){return this._getDuplicate()},set duplicate(K){this._setDuplicate(K)}},{Client:H,Message:F}}(window),'undefined'!=typeof module&&'undefined'!=typeof exports){module.exports=OAuth;var CryptoJS=require('crypto-js')}function OAuth(t){if(!(this instanceof OAuth))return new OAuth(t);if(t||(t={}),!t.consumer)throw new Error('consumer option is required');switch(this.consumer=t.consumer,this.signature_method=t.signature_method||'HMAC-SHA1',this.nonce_length=t.nonce_length||32,this.version=t.version||'1.0',this.parameter_seperator=t.parameter_seperator||', ',this.last_ampersand='undefined'==typeof t.last_ampersand||t.last_ampersand,this.signature_method){case'HMAC-SHA1':this.hash=function(o,u){return CryptoJS.HmacSHA1(o,u).toString(CryptoJS.enc.Base64)};break;case'HMAC-SHA256':this.hash=function(o,u){return CryptoJS.HmacSHA256(o,u).toString(CryptoJS.enc.Base64)};break;case'PLAINTEXT':this.hash=function(o,u){return u};break;case'RSA-SHA1':throw new Error('oauth-1.0a does not support this signature method right now. Coming Soon...');default:throw new Error('The OAuth 1.0a protocol defines three signature methods: HMAC-SHA1, RSA-SHA1, and PLAINTEXT only');}}OAuth.prototype.authorize=function(t,o){var u={oauth_consumer_key:this.consumer.public,oauth_nonce:this.getNonce(),oauth_signature_method:this.signature_method,oauth_timestamp:this.getTimeStamp(),oauth_version:this.version};return o||(o={}),o.public&&(u.oauth_token=o.public),t.data||(t.data={}),u.oauth_signature=this.getSignature(t,o.secret,u),u},OAuth.prototype.getSignature=function(t,o,u){return this.hash(this.getBaseString(t,u),this.getSigningKey(o))},OAuth.prototype.getBaseString=function(t,o){return t.method.toUpperCase()+'&'+this.percentEncode(this.getBaseUrl(t.url))+'&'+this.percentEncode(this.getParameterString(t,o))},OAuth.prototype.getParameterString=function(t,o){var u=this.sortObject(this.percentEncodeData(this.mergeObject(o,this.mergeObject(t.data,this.deParamUrl(t.url))))),_='';for(var y in u)_+=y+'='+u[y]+'&';return _=_.substr(0,_.length-1),_},OAuth.prototype.getSigningKey=function(t){return t=t||'',this.last_ampersand||t?this.percentEncode(this.consumer.secret)+'&'+this.percentEncode(t):this.percentEncode(this.consumer.secret)},OAuth.prototype.getBaseUrl=function(t){return t.split('?')[0]},OAuth.prototype.deParam=function(t){for(var y,o=decodeURIComponent(t).split('&'),u={},_=0;_<o.length;_++)y=o[_].split('='),u[y[0]]=y[1];return u},OAuth.prototype.deParamUrl=function(t){var o=t.split('?');return 1===o.length?{}:this.deParam(o[1])},OAuth.prototype.percentEncode=function(t){return encodeURIComponent(t).replace(/\!/g,'%21').replace(/\*/g,'%2A').replace(/\'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29')},OAuth.prototype.percentEncodeData=function(t){var o={};for(var u in t)o[this.percentEncode(u)]=this.percentEncode(t[u]);return o},OAuth.prototype.toHeader=function(t){t=this.sortObject(t);var o='OAuth ';for(var u in t)-1!==u.indexOf('oauth_')&&(o+=this.percentEncode(u)+'="'+this.percentEncode(t[u])+'"'+this.parameter_seperator);return{Authorization:o.substr(0,o.length-this.parameter_seperator.length)}},OAuth.prototype.getNonce=function(t){var o='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',u='';t||(t=this.nonce_length);for(var _=0;_<t;_++)u+=o[parseInt(Math.random()*o.length,10)];return u},OAuth.prototype.getTimeStamp=function(){return parseInt(new Date().getTime()/1e3,10)},OAuth.prototype.mergeObject=function(t,o){var u=t;for(var _ in o)u[_]=o[_];return u},OAuth.prototype.sortObject=function(t){var o=Object.keys(t),u={};o.sort();for(var y,_=0;_<o.length;_++)y=o[_],u[y]=t[y];return u};var CryptoJS=CryptoJS||function(t,o){var u={},_=u.lib={},y=function(){},I=_.Base={extend:function(C){y.prototype=this;var N=new y;return C&&N.mixIn(C),N.hasOwnProperty('init')||(N.init=function(){N.$super.init.apply(this,arguments)}),N.init.prototype=N,N.$super=this,N},create:function(){var C=this.extend();return C.init.apply(C,arguments),C},init:function(){},mixIn:function(C){for(var N in C)C.hasOwnProperty(N)&&(this[N]=C[N]);C.hasOwnProperty('toString')&&(this.toString=C.toString)},clone:function(){return this.init.prototype.extend(this)}},M=_.WordArray=I.extend({init:function(C,N){C=this.words=C||[],this.sigBytes=N==o?4*C.length:N},toString:function(C){return(C||S).stringify(this)},concat:function(C){var N=this.words,R=C.words,P=this.sigBytes;if(C=C.sigBytes,this.clamp(),P%4)for(var U=0;U<C;U++)N[P+U>>>2]|=(255&R[U>>>2]>>>24-8*(U%4))<<24-8*((P+U)%4);else if(65535<R.length)for(U=0;U<C;U+=4)N[P+U>>>2]=R[U>>>2];else N.push.apply(N,R);return this.sigBytes+=C,this},clamp:function(){var C=this.words,N=this.sigBytes;C[N>>>2]&=4294967295<<32-8*(N%4),C.length=t.ceil(N/4)},clone:function(){var C=I.clone.call(this);return C.words=this.words.slice(0),C},random:function(C){for(var N=[],R=0;R<C;R+=4)N.push(0|4294967296*t.random());return new M.init(N,C)}}),E=u.enc={},S=E.Hex={stringify:function(C){var N=C.words;C=C.sigBytes;for(var U,R=[],P=0;P<C;P++)U=255&N[P>>>2]>>>24-8*(P%4),R.push((U>>>4).toString(16)),R.push((15&U).toString(16));return R.join('')},parse:function(C){for(var N=C.length,R=[],P=0;P<N;P+=2)R[P>>>3]|=parseInt(C.substr(P,2),16)<<24-4*(P%8);return new M.init(R,N/2)}},A=E.Latin1={stringify:function(C){var N=C.words;C=C.sigBytes;for(var R=[],P=0;P<C;P++)R.push(String.fromCharCode(255&N[P>>>2]>>>24-8*(P%4)));return R.join('')},parse:function(C){for(var N=C.length,R=[],P=0;P<N;P++)R[P>>>2]|=(255&C.charCodeAt(P))<<24-8*(P%4);return new M.init(R,N)}},v=E.Utf8={stringify:function(C){try{return decodeURIComponent(escape(A.stringify(C)))}catch(N){throw Error('Malformed UTF-8 data')}},parse:function(C){return A.parse(unescape(encodeURIComponent(C)))}},T=_.BufferedBlockAlgorithm=I.extend({reset:function(){this._data=new M.init,this._nDataBytes=0},_append:function(C){'string'==typeof C&&(C=v.parse(C)),this._data.concat(C),this._nDataBytes+=C.sigBytes},_process:function(C){var N=this._data,R=N.words,P=N.sigBytes,U=this.blockSize,L=P/(4*U),L=C?t.ceil(L):t.max((0|L)-this._minBufferSize,0);if(C=L*U,P=t.min(4*C,P),C){for(var B=0;B<C;B+=U)this._doProcessBlock(R,B);B=R.splice(0,C),N.sigBytes-=P}return new M.init(B,P)},clone:function(){var C=I.clone.call(this);return C._data=this._data.clone(),C},_minBufferSize:0});_.Hasher=T.extend({cfg:I.extend(),init:function(C){this.cfg=this.cfg.extend(C),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(C){return this._append(C),this._process(),this},finalize:function(C){return C&&this._append(C),this._doFinalize()},blockSize:16,_createHelper:function(C){return function(N,R){return new C.init(R).finalize(N)}},_createHmacHelper:function(C){return function(N,R){return new O.HMAC.init(C,R).finalize(N)}}});var O=u.algo={};return u}(Math);(function(){var t=CryptoJS,o=t.lib,u=o.WordArray,_=o.Hasher,y=[],o=t.algo.SHA1=_.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(I,M){for(var E=this._hash.words,S=E[0],A=E[1],v=E[2],T=E[3],O=E[4],C=0;80>C;C++){if(16>C)y[C]=0|I[M+C];else{var N=y[C-3]^y[C-8]^y[C-14]^y[C-16];y[C]=N<<1|N>>>31}N=(S<<5|S>>>27)+O+y[C],N=20>C?N+((A&v|~A&T)+1518500249):40>C?N+((A^v^T)+1859775393):60>C?N+((A&v|A&T|v&T)-1894007588):N+((A^v^T)-899497514),O=T,T=v,v=A<<30|A>>>2,A=S,S=N}E[0]=0|E[0]+S,E[1]=0|E[1]+A,E[2]=0|E[2]+v,E[3]=0|E[3]+T,E[4]=0|E[4]+O},_doFinalize:function(){var I=this._data,M=I.words,E=8*this._nDataBytes,S=8*I.sigBytes;return M[S>>>5]|=128<<24-S%32,M[(S+64>>>9<<4)+14]=Math.floor(E/4294967296),M[(S+64>>>9<<4)+15]=E,I.sigBytes=4*M.length,this._process(),this._hash},clone:function(){var I=_.clone.call(this);return I._hash=this._hash.clone(),I}});t.SHA1=_._createHelper(o),t.HmacSHA1=_._createHmacHelper(o)})(),function(){var t=CryptoJS,o=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(u,_){u=this._hasher=new u.init,'string'==typeof _&&(_=o.parse(_));var y=u.blockSize,I=4*y;_.sigBytes>I&&(_=u.finalize(_)),_.clamp();for(var M=this._oKey=_.clone(),E=this._iKey=_.clone(),S=M.words,A=E.words,v=0;v<y;v++)S[v]^=1549556828,A[v]^=909522486;M.sigBytes=E.sigBytes=I,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var _=this._hasher;return u=_.finalize(u),_.reset(),_.finalize(this._oKey.clone().concat(u))}})}(),function(){var t=CryptoJS,o=t.lib.WordArray;t.enc.Base64={stringify:function(u){var _=u.words,y=u.sigBytes,I=this._map;u.clamp(),u=[];for(var M=0;M<y;M+=3)for(var E=(255&_[M>>>2]>>>24-8*(M%4))<<16|(255&_[M+1>>>2]>>>24-8*((M+1)%4))<<8|255&_[M+2>>>2]>>>24-8*((M+2)%4),S=0;4>S&&M+0.75*S<y;S++)u.push(I.charAt(63&E>>>6*(3-S)));if(_=I.charAt(64))for(;u.length%4;)u.push(_);return u.join('')},parse:function(u){var _=u.length,y=this._map,I=y.charAt(64);I&&(I=u.indexOf(I),-1!=I&&(_=I));for(var I=[],M=0,E=0;E<_;E++)if(E%4){var S=y.indexOf(u.charAt(E-1))<<2*(E%4),A=y.indexOf(u.charAt(E))>>>6-2*(E%4);I[M>>>2]|=(S|A)<<24-8*(M%4),M++}return o.create(I,M)},_map:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='}}(),function(t){function o(u,_){if({}.hasOwnProperty.call(o.cache,u))return o.cache[u];var y=o.resolve(u);if(!y)throw new Error('Failed to resolve module '+u);var I={id:u,require:o,filename:u,exports:{},loaded:!1,parent:_,children:[]};_&&_.children.push(I);var M=u.slice(0,u.lastIndexOf('/')+1);return o.cache[u]=I.exports,y.call(I.exports,I,I.exports,M,u),I.loaded=!0,o.cache[u]=I.exports}o.modules={},o.cache={},o.resolve=function(u){return{}.hasOwnProperty.call(o.modules,u)?o.modules[u]:void 0},o.define=function(u,_){o.modules[u]=_},o.define('/index.js',function(u){function M(){M.init.call(this)}var E={};E.isObject=function(A){return'object'==typeof A&&null!==A},E.isNumber=function(A){return'number'==typeof A},E.isUndefined=function(A){return void 0===A},E.isFunction=function(A){return'function'==typeof A},u.exports=M,M.EventEmitter=M,M.prototype._events=void 0,M.prototype._maxListeners=void 0,M.defaultMaxListeners=10,M.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},M.prototype.setMaxListeners=function(S){if(!E.isNumber(S)||0>S||isNaN(S))throw TypeError('n must be a positive number');return this._maxListeners=S,this},M.prototype.emit=function(S){var A,v,T,O,C,N;if(v=this._events[S],E.isUndefined(v))return!1;if(E.isFunction(v))switch(arguments.length){case 1:v.call(this);break;case 2:v.call(this,arguments[1]);break;case 3:v.call(this,arguments[1],arguments[2]);break;default:for(T=arguments.length,O=Array(T-1),C=1;C<T;C++)O[C-1]=arguments[C];v.apply(this,O);}else if(E.isObject(v)){for(T=arguments.length,O=Array(T-1),C=1;C<T;C++)O[C-1]=arguments[C];for(N=v.slice(),T=N.length,C=0;C<T;C++)N[C].apply(this,O)}return!0},M.prototype.addListener=function(S,A){var v;if(!E.isFunction(A))throw TypeError('listener must be a function');if(this._events||(this._events={}),this._events.newListener&&this.emit('newListener',S,E.isFunction(A.listener)?A.listener:A),this._events[S]?E.isObject(this._events[S])?this._events[S].push(A):this._events[S]=[this._events[S],A]:this._events[S]=A,E.isObject(this._events[S])&&!this._events[S].warned){var v;v=E.isUndefined(this._maxListeners)?M.defaultMaxListeners:this._maxListeners,v&&0<v&&this._events[S].length>v&&(this._events[S].warned=!0,E.isFunction(console.error)&&console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[S].length),E.isFunction(console.trace)&&console.trace())}return this},M.prototype.on=M.prototype.addListener,M.prototype.once=function(S,A){function v(){this.removeListener(S,v),T||(T=!0,A.apply(this,arguments))}if(!E.isFunction(A))throw TypeError('listener must be a function');var T=!1;return v.listener=A,this.on(S,v),this},M.prototype.removeListener=function(S,A){var v,T,O,C;if(!E.isFunction(A))throw TypeError('listener must be a function');if(!(this._events&&this._events[S]))return this;if(v=this._events[S],O=v.length,T=-1,v===A||E.isFunction(v.listener)&&v.listener===A)delete this._events[S],this._events.removeListener&&this.emit('removeListener',S,A);else if(E.isObject(v)){for(C=O;0<C--;)if(v[C]===A||v[C].listener&&v[C].listener===A){T=C;break}if(0>T)return this;1===v.length?(v.length=0,delete this._events[S]):v.splice(T,1),this._events.removeListener&&this.emit('removeListener',S,A)}return this},M.prototype.removeAllListeners=function(S){var A,v;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[S]&&delete this._events[S],this;if(0===arguments.length){for(A in this._events)'removeListener'!==A&&this.removeAllListeners(A);return this.removeAllListeners('removeListener'),this._events={},this}if(v=this._events[S],E.isFunction(v))this.removeListener(S,v);else if(Array.isArray(v))for(;v.length;)this.removeListener(S,v[v.length-1]);return delete this._events[S],this},M.prototype.listeners=function(S){var A;return A=this._events&&this._events[S]?E.isFunction(this._events[S])?[this._events[S]]:this._events[S].slice():[],A},M.listenerCount=function(S,A){var v;return v=S._events&&S._events[A]?E.isFunction(S._events[A])?1:S._events[A].length:0,v}}),t.EventEmitter=o('/index.js')}.call(this,this),'undefined'==typeof Microgear&&(Microgear={}),Microgear.create=function(t){function o(D){for(var F,w={},V=D.split('&'),H=0;H<V.length;H++)F=V[H].split('='),w[F[0]]=F[1];return w}function u(){return!0}function _(D){var w;try{w=JSON.parse(D)}catch(V){return null}return w}function y(D,w){var V=new XMLHttpRequest;return'withCredentials'in V?V.open(D,w,!0):'undefined'==typeof XDomainRequest?V=null:(V=new XDomainRequest,V.open(D,w)),V}function I(D){R.lastretryconnection=Date.now(),R.createtoken(function(w){switch(R.mgstate=w,w){case 0:if(R.appkey||R.secret)throw new Error('Error: request token is not issued, please check your appkey and appsecret');else throw new Error('Error: request token is not issued, please check your consumerkey and consumersecret');return;case 1:return void I(D);case 2:return void I(D);case 3:return void R.brokerconnect(function(){D&&D()});}})}function M(){for(var D=0;D<R.subscriptions.length;D++)R.debugmode&&console.log('auto subscribe '+R.subscriptions[D]),R.client.subscribe('/'+R.appid+R.subscriptions[D]);R.client.subscribe('/&id/'+R.clientid+'/#'),R.listeners('present')&&R.client.subscribe('/'+R.appid+'/&present'),R.listeners('absent')&&R.client.subscribe('/'+R.appid+'/&absent'),R.gearalias&&R.setalias(R.gearalias),R.emit('connected');var w=setInterval(function(){if(0<R.messageBuffer.length){var V=R.messageBuffer.shift();V.destinationName='/'+R.appid+V.destinationName,R.client.send(V)}else clearInterval(w)},200)}function E(D){4==D.code&&(R.emit('info','invalid token, requesting a new one'),u()&&(R.requesttoken={},R.accesstoken={},L.set('microgear.'+R.gearkey+'.key',''),L.set('microgear.'+R.gearkey+'.accesstoken',JSON.stringify({})),L.set('microgear.'+R.gearkey+'.requesttoken',JSON.stringify({}))))}function S(D){var w=D.destinationName,V=D.payloadString,H=R.appid.length+1,F=w.substr(H,w.length-H);if('/&'==F.substr(0,2)){var K=(F.substr(1,F.length-1)+'/').indexOf('/'),Q=F.substr(2,K);switch(Q){case'present':case'absent':var G;try{G=JSON.parse(V.toString())}catch(z){G=V.toString()}R.emit(Q,G);break;case'resetendpoint':R.accesstoken&&R.accesstoken.endpoint&&(R.accesstoken.endpoint='',L.set('microgear.'+R.gearkey+'.accesstoken',JSON.stringify(R.accesstoken)),R.emit('info','endpoint reset'));}}else'@'==w.substr(0,1)?'@info'===w?R.emit('info',V):'@error'===w?R.emit('error',V):void 0:R.emit('message',w,V)}function A(){R.emit('disconnected')}function v(){R&&R.onlinemode&&R.client&&!R.client.isConnected()&&Date.now()-R.lastretryconnection>RETRYCONNECTIONINTERVAL&&(R.lastretryconnection=Date.now(),I(function(){}))}var T=t.key||t.gearkey||'',O=t.secret||t.gearsecret||'',C=t.alias||t.gearalias||'';if(t){var N=t.scope,R=null,P=function(D,w,V){this.securemode=USETLS,this.gearkey=D,this.gearsecret=w,this.gearalias=V?V.substring(0,16):null,this.client=null,this.subscriptions=[],this.messageBuffer=[],this.requesttoken={},this.accesstoken={}},U={},L={get:function(D){return storejs.enabled?storejs.get(D):U[D]},set:function(D,w){storejs.enabled?storejs.set(D,w):U[D]=w}};if(P.prototype=new EventEmitter,P.prototype.createtoken=function(D){var w=OAuth({consumer:{public:R.gearkey,secret:R.gearsecret},signature_method:'HMAC-SHA1'});if(u()&&(!R.accesstoken||!R.accesstoken.token)){var V=L.get('microgear.'+R.gearkey+'.key');V&&V!=R.gearkey&&R.resettoken(),R.accesstoken=_(L.get('microgear.'+R.gearkey+'.accesstoken'))}if(R.accesstoken&&R.accesstoken.token&&R.accesstoken.secret&&R.accesstoken.endpoint)'function'==typeof D&&D(3);else{var H;if(H=R.securemode?'https://'+GEARAUTH+':'+GEARAPISECUREPORT:'http://'+GEARAUTH+':'+GEARAPIPORT,!R.requesttoken&&u()){var V=L.get('microgear.'+R.gearkey+'.key');V&&V!=R.gearkey&&R.resettoken(),R.requesttoken=_(L.get('microgear.'+R.gearkey+'.requesttoken'))}if(R.requesttoken&&R.requesttoken.token&&R.requesttoken.secret){var F={url:H+'/api/atoken',method:'POST',data:{oauth_verifier:R.requesttoken.verifier}},K=y(F.method,F.url);if(!K)throw new Error('CORS not supported');var Q={public:R.requesttoken.token,secret:R.requesttoken.secret};K.setRequestHeader('Authorization',w.toHeader(w.authorize(F,Q)).Authorization),K.send(),K.onreadystatechange=function(){if(4==K.readyState)switch(K.status){case 200:var z=o(K.responseText);R.accesstoken={},R.accesstoken.token=z.oauth_token,R.accesstoken.secret=z.oauth_token_secret,R.accesstoken.endpoint=unescape(z.endpoint);var J=R.accesstoken.secret+'&'+R.gearsecret,Y=CryptoJS.HmacSHA1(R.accesstoken.token,J).toString(CryptoJS.enc.Base64).replace(/\//g,'_');R.accesstoken.revokecode=unescape(Y),'S'!=z.flag&&u()&&(L.set('microgear.'+R.gearkey+'.key',R.gearkey),L.set('microgear.'+R.gearkey+'.accesstoken',JSON.stringify(R.accesstoken))),'function'==typeof D&&D(2);break;case 401:R.emit('error',{code:401,message:'Not authorized'}),D&&D(1);break;case 500:R.emit('error',{status:500,message:'Request token invalid'}),'function'==typeof D&&D(0);break;default:R.emit('error',{status:503,message:'Cannot obtain a token'}),'function'==typeof D&&D(0);}}}else{var G=this.gearalias?this.gearalias:MGREV;var F={url:H+'/api/rtoken',method:'POST',data:{oauth_callback:'scope=&appid='+R.appid+'&mgrev='+MGREV+'&verifier='+G}},K=y(F.method,F.url);if(!K)throw new Error('CORS not supported');K.setRequestHeader('Authorization',w.toHeader(w.authorize(F)).Authorization),K.send(),K.onreadystatechange=function(){if(4==K.readyState)switch(K.status){case 200:var z=o(K.responseText);R.requesttoken={},R.requesttoken.token=z.oauth_token,R.requesttoken.secret=z.oauth_token_secret,R.requesttoken.verifier=G,u()&&L.set('microgear.'+R.gearkey+'.requesttoken',JSON.stringify(R.requesttoken)),'function'==typeof D&&D(1);break;default:R.emit('error',{status:503,message:'Cannot obtain a token'}),'function'==typeof D&&D(0);}}}}},P.prototype.brokerconnect=function(){var K,w=R.accesstoken.secret+'&'+R.gearsecret,V=R.gearkey+'%'+Math.floor(Date.now()/1e3),H=CryptoJS.HmacSHA1(R.accesstoken.token+'%'+V,w).toString(CryptoJS.enc.Base64),F=R.accesstoken.endpoint.substr(6).split(':');K=R.securemode?GBWSSPORT:GBWSPORT,R.client=new Paho.MQTT.Client(F[0],+K,R.accesstoken.token),R.client.onConnectionLost=A,R.client.onMessageArrived=S,R.client.onError=E,R.client.connect({userName:V,password:H,useSSL:R.securemode,onSuccess:M})},setInterval(v,MONLOOPINTERVAL),P.prototype.connect=function(D,w){this.onlinemode=!0,R.appid=D,I(w)},P.prototype.disconnect=function(){this.onlinemode=!1,R.client.disconnect()},P.prototype.subscribe=function(D){R.client&&R.client.isConnected()?0>R.subscriptions.indexOf(D)&&R.client.subscribe('/'+R.appid+D,{onSuccess:function(){0>R.subscriptions.indexOf(D)&&R.subscriptions.push(D)},onFailure:function(){}}):0>R.subscriptions.indexOf(D)&&R.subscriptions.push(D)},P.prototype.unsubscribe=function(D){R.client&&R.client.isConnected()?R.client.unsubscribe('/'+R.appid+D,{onSuccess:function(){0>R.subscriptions.indexOf(D)&&R.subscriptions.splice(R.subscriptions.indexOf(D))},onFailure:function(){}}):0<=R.subscriptions.indexOf(D)&&R.subscriptions.splice(R.subscriptions.indexOf(D))},P.prototype.publish=function(D,w,V){var H='';if('undefined'!=typeof w){H='object'==typeof w?JSON.stringify(w):w.toString();var F=new Paho.MQTT.Message(H);V&&(F.retained=!0),R.client&&R.client.isConnected()?(F.destinationName='/'+R.appid+D,R.client.send(F)):R.messageBuffer.length<MESSAGEBUFFERSIZE&&(F.destinationName=D,R.messageBuffer.push(F))}},P.prototype.setname=function(D){R.gearname&&R.unsubscribe('/gearname/'+R.gearname),R.subscribe('/gearname/'+D,function(){R.gearname=D,'function'==typeof callback&&callback()})},P.prototype.setalias=function(D,w){R.publish('/@setalias/'+D,'',{},function(){R.gearalias=D,'function'==typeof w&&w()})},P.prototype.unsetname=function(D){null!=R.gearname&&R.unsubscribe('/gearname/'+R.gearname,function(){R.gearname=null,'function'==typeof D&&D()})},P.prototype.writefeed=function(D,w,V){var H='/@writefeed/'+D;V&&(H+='/'+V),w='object'==typeof w?JSON.stringify(w):w.toString(),R.publish(H,w)},P.prototype.chat=function(D,w,V){R.publish('/gearname/'+D,w,V)},P.prototype.gettoken=function(){var D={token:R.accesstoken.token,secret:R.accesstoken.secret};return console.log(D),D},P.prototype.resettoken=function(D){var w=_(L.get('microgear.'+R.gearkey+'.accesstoken'));if(w&&w.token&&w.revokecode){var V=new XMLHttpRequest;V.onreadystatechange=function(){if(4==V.readyState)switch(V.status){case 200:'FAILED'!=V.responseText&&u()&&(R.requesttoken={},R.accesstoken={},L.set('microgear.'+R.gearkey+'.key',''),L.set('microgear.'+R.gearkey+'.accesstoken',JSON.stringify({})),L.set('microgear.'+R.gearkey+'.requesttoken',JSON.stringify({}))),'function'==typeof D&&D();break;default:R.emit('error','Reset token error : '+V.responseText),'function'==typeof D&&D(V.responseText);}};var H,F,K=w.revokecode.replace(/\//g,'_');F=R.securemode?'https://'+GEARAUTH+':'+GEARAPISECUREPORT:'http://'+GEARAUTH+':'+GEARAPIPORT,H=F+'/api/revoke/'+w.token+'/'+K,V.open('GET',H,!0),V.send(null)}else'function'==typeof D&&D()},P.prototype.on('newListener',function(D){'present'===D?R.client&&R.client.isConnected()&&R.subscribe('/@present'):'absent'===D?R.client&&R.client.isConnected()&&R.subscribe('/@absent'):void 0}),P.prototype.usetls=function(D){R.securemode=D},P.prototype.connected=function(){return!!R.client&&R.client.isConnected()},P.prototype.setconfig=function(D,w){'GEARAUTH'===D?GEARAUTH=w.toString():void 0},P.prototype.getconfig=function(D){return'GEARAUTH'===D?GEARAUTH:void 0},P.prototype.pushowner=function(D){R.publish('/@push/owner',D)},P.prototype.setName=P.prototype.setname,P.prototype.unsetName=P.prototype.unsetname,P.prototype.setAlias=P.prototype.setalias,P.prototype.writeFeed=P.prototype.writefeed,P.prototype.getToken=P.prototype.gettoken,P.prototype.resetToken=P.prototype.resettoken,P.prototype.useTLS=P.prototype.usetls,P.prototype.setConfig=P.prototype.setconfig,P.prototype.getConfig=P.prototype.getconfig,P.prototype.pushOwner=P.prototype.pushowner,T&&O){var B=new P(T,O,C);return B.scope=t.scope,R=B,B}return null}};
